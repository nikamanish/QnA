<% provide(:title, "Requests") %>

<h1>Join Request</h1>

<div class="row">
	<div class="col-md-4 col-md-offset-4">
		<% result =  Request.joins("INNER JOIN memberships ON requests.group_id = memberships.group_id").select(:id, :group_id, :sender_id).where("memberships.user_id = #{current_user.id} AND memberships.admin = true AND requests.granted IS NULL") %>
		<ul>
			<div>
				<% result.each do |i| %>
					<li>
						<%= form_for(:join, url: requests_path) do |f| %>
							<div class="row">
								<%= f.hidden_field :group_id, :value => i["group_id"].to_i %>
								<%= f.hidden_field :id, :value => i["id"].to_i %>
								<%= f.hidden_field :user_id, :value => i["sender_id"].to_i %>
								<div class="col-md-6">
									<% user = User.find_by(id: i["sender_id"]) %>
									<% group = Group.find_by(id: i["group_id"]) %>
									<%= user.name %> <%= group.name %>
								</div>
								<div class="col-md-3">
									<%= f.submit "Yes", class: "btn btn-primary" %>
								</div>
								<div class="col-md-3">
									<%= f.submit "No", class: "btn btn-primary" %>
								</div>
							</div>
						<% end %>
					</li>
				<% end %>
			</div>
		</ul>
	</div>
</div>